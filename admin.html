<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Youth Service Philippines</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; color: #333; }
    
    .header { background: linear-gradient(135deg, #fff 0%, #fff5f0 100%); border-bottom: 3px solid #ff8c42; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 1rem 0; }
    .nav-container { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; max-width: 1400px; margin: 0 auto; }
    .logo { display: flex; align-items: center; gap: 0.8rem; }
    .logo-icon { width: 50px; height: 50px; border-radius: 50%; object-fit: contain; }
    .logo-text h2 { font-size: 1.3rem; margin: 0; font-weight: 700; }
    .logo-text p { color: #ff8c42; margin: 0; font-weight: 600; }
    .nav-links { display: flex; list-style: none; gap: 2rem; }
    .nav-links a { text-decoration: none; color: #333; font-weight: 500; }
    .sign-in-btn { background: #ff8c42; color: white; padding: 0.6rem 1rem; border-radius: 5px; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; font-weight: 600; }

    .admin-header { max-width: 1400px; margin: 0 auto; padding: 2rem; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #ff6a00 0%, #ff8c42 100%); border-radius: 0 0 12px 12px; box-shadow: 0 6px 20px rgba(255,140,66,0.15); }
    .admin-header > div { display: flex; align-items: center; gap: 1.2rem; flex: 1; }
    .admin-header .logo-icon { width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.15); padding: 0.5rem; object-fit: contain; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .admin-header h1 { font-size: 2.2rem; color: white; font-weight: 700; margin-bottom: 0.25rem; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .admin-header .subtitle { color: rgba(255,255,255,0.85); font-size: 0.95rem; }
    .back-btn { background: rgba(255,255,255,0.15); color: white; border: 1.5px solid rgba(255,255,255,0.3); padding: 0.7rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.25s ease; display: flex; align-items: center; gap: 0.5rem; }
    .back-btn:hover { background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.5); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

    .stats-grid { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }
    .stat-card { background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid #ff8c42; }
    .stat-card .label { color: #666; font-size: 0.9rem; font-weight: 500; margin-bottom: 0.5rem; }
    .stat-card .value { font-size: 2.2rem; font-weight: 800; color: #333; }
    .stat-card .icon { float: right; font-size: 2rem; color: #ffd9c0; }

    /* Program card adjustments for admin */
    .program-card { background: white; border-radius: 10px; box-shadow: 0 6px 18px rgba(17,24,39,0.06); overflow: hidden; border: 1px solid #eef2f6; display:flex; flex-direction:column; }
    .program-card .program-img { width:100%; height:140px; object-fit:cover; background:#f6f7f9; display:block; }
    .program-card .program-body { padding:12px; display:flex; flex-direction:column; gap:8px; }
    .program-card input[type="text"], .program-card textarea { width:100%; border:1px solid #e6e9ee; padding:8px; border-radius:6px; font-size:0.95rem; }
    .program-card .controls { display:flex; gap:8px; align-items:center; }

    /* Toast notifications */
    .toast-container { position: fixed; right: 20px; bottom: 20px; z-index: 9999; display:flex; flex-direction:column; gap:8px; }
    .toast { min-width: 220px; max-width: 320px; padding: 10px 14px; border-radius: 8px; color: #fff; box-shadow: 0 6px 18px rgba(17,24,39,0.08); font-weight:600; font-size:0.95rem; opacity:0; transform:translateY(8px); transition:all 260ms ease; }
    .toast.show { opacity:1; transform:translateY(0); }
    .toast.success { background: linear-gradient(90deg,#16a34a,#34d399); }
    .toast.warn { background: linear-gradient(90deg,#f59e0b,#fb923c); }
    .toast.error { background: linear-gradient(90deg,#ef4444,#f97316); }

    .tabs-section { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }
    .tabs-nav { 
      display: flex; 
      gap: 0.8rem; 
      background: linear-gradient(90deg, #f5f7fa 0%, #eef2f6 100%);
      padding: 0.8rem 1rem;
      border-radius: 12px 12px 0 0;
      border-bottom: 3px solid #ff8c42;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      flex-wrap: wrap;
    }
    .tab-btn { 
      background: linear-gradient(135deg, #f0f4f9 0%, #e8eef5 100%);
      border: 1.5px solid #dfe4ea;
      padding: 0.8rem 1.5rem; 
      cursor: pointer; 
      font-weight: 600; 
      color: #666; 
      font-size: 0.95rem; 
      position: relative;
      border-radius: 8px 8px 0 0;
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .tab-btn:hover { 
      background: linear-gradient(135deg, #e0e6f0 0%, #d8dff0 100%);
      color: #333;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    .tab-btn.active { 
      background: linear-gradient(135deg, #ff6a00 0%, #ff8c42 100%);
      color: white; 
      border-color: #ff8c42;
      box-shadow: 0 4px 12px rgba(255,140,66,0.25);
    }
    .tab-btn.active::after { 
      display: none;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeInContent 0.3s ease; }
    @keyframes fadeInContent {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .stats-box { 
      background: white; 
      padding: 2rem; 
      border-radius: 0 8px 8px 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border: 1.5px solid #f0f4f9;
      border-top: none;
    }
    .stats-box-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
    .stats-box h3 { font-size: 1.2rem; color: #333; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; }
    .stats-box h3 i { color: #ff8c42; font-size: 1.3rem; }
    .edit-btn { background: white; color: #333; border: 1px solid #e0e0e0; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; }
    .edit-btn:hover { background: #f9f9f9; }

    .stats-items { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; }
    .stats-item { text-align: left; }
    .stats-item .label { color: #666; font-size: 0.9rem; margin-bottom: 0.5rem; font-weight: 500; }
    .stats-item .number { font-size: 2rem; font-weight: 800; color: #333; }

    @media (max-width: 1024px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .action-buttons { gap: 0.75rem; }
      .action-btn { padding: 0.6rem 1rem; font-size: 0.85rem; }
    }

    @media (max-width: 768px) {
      .admin-header { flex-direction: column; gap: 1rem; }
      .stats-grid { grid-template-columns: 1fr; }
      .tabs-nav { overflow-x: auto; }
      .action-buttons { gap: 0.5rem; }
      .action-btn { flex: 1 1 calc(50% - 0.25rem); }
    }

    /* Modal styles */
    .modal-overlay { 
      position: fixed; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0; 
      background: rgba(0,0,0,0.6); 
      display: none; 
      justify-content: center; 
      align-items: center; 
      z-index: 5000;
      backdrop-filter: blur(2px);
    }
    .modal-overlay.active { display: flex; animation: fadeIn 0.2s ease; }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content { 
      background: white; 
      border-radius: 14px; 
      padding: 0;
      max-width: 520px; 
      width: 90%; 
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 70px rgba(0,0,0,0.25);
      overflow: hidden;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .modal-content::before {
      content: '';
      display: block;
      height: 4px;
      background: linear-gradient(90deg, #ff6a00 0%, #ff8c42 100%);
    }
    .modal-header { 
      font-size: 1.4rem; 
      font-weight: 700; 
      margin-bottom: 1.8rem;
      color: #333;
      padding: 2rem 2rem 0;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    .modal-header::before {
      content: '\f007';
      font-family: 'Font Awesome 6 Free';
      font-weight: 600;
      color: #ff8c42;
      font-size: 1.3rem;
    }
    .modal-header[id*="member"]::before {
      content: '\f234';
      font-weight: 600;
    }
    .form-group { 
      margin-bottom: 1.5rem;
      padding: 0 2rem;
    }
    .form-group:last-of-type {
      margin-bottom: 2rem;
    }
    .form-group label { 
      display: block; 
      margin-bottom: 0.7rem; 
      font-weight: 600; 
      color: #333;
      font-size: 0.95rem;
      text-transform: capitalize;
      letter-spacing: 0.3px;
    }
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="number"],
    .form-group textarea,
    .form-group input[type="file"],
    .form-group select {
      width: 100%;
      padding: 0.8rem 0.95rem;
      border: 1.5px solid #dfe4ea;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.95rem;
      background: #fafbfc;
      transition: all 0.25s ease;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.02);
    }
    .form-group input[type="text"]:focus,
    .form-group input[type="email"]:focus,
    .form-group input[type="number"]:focus,
    .form-group textarea:focus,
    .form-group input[type="file"]:focus,
    .form-group select:focus {
      outline: none;
      border-color: #ff8c42;
      background: white;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.02), 0 0 0 3px rgba(255,140,66,0.1);
    }
    .form-group input[type="text"]:hover,
    .form-group input[type="email"]:hover,
    .form-group input[type="number"]:hover,
    .form-group textarea:hover,
    .form-group select:hover {
      border-color: #ffb399;
      background: white;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 90px;
      font-family: inherit;
    }
    .form-group select {
      cursor: pointer;
      padding-right: 2.5rem;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ff8c42' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.95rem center;
      appearance: none;
      padding-right: 2.5rem;
    }
    .image-preview {
      margin-top: 0.8rem;
      width: 100%;
      height: 200px;
      border-radius: 10px;
      object-fit: cover;
      background: linear-gradient(135deg, #f5f7fa 0%, #eef2f6 100%);
      display: none;
      border: 2px solid #e0e6f0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .image-preview.active { 
      display: block;
      animation: imageReveal 0.3s ease;
    }
    @keyframes imageReveal {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .modal-actions {
      display: flex;
      gap: 1rem;
      padding: 0 2rem 2rem;
      justify-content: flex-end;
      margin-top: 0.5rem;
    }
    .modal-btn {
      padding: 0.8rem 1.8rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .modal-btn:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }
    .modal-btn.primary {
      background: linear-gradient(135deg, #ff6a00 0%, #ff8c42 100%);
      color: white;
    }
    .modal-btn.primary:hover { 
      background: linear-gradient(135deg, #e85e00 0%, #ff7a2e 100%);
    }
    .modal-btn.primary:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.12);
    }
    .modal-btn.secondary {
      background: white;
      color: #333;
      border: 1.5px solid #dfe4ea;
    }
    .modal-btn.secondary:hover { 
      background: #f8f9fb;
      border-color: #c5cad4;
    }
    .modal-btn.secondary:active {
      transform: translateY(0);
      background: #f0f2f7;
    }
    .modal-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .modal-btn:disabled:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    /* Unified button system for admin actions */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.7rem 1rem;
      border-radius: 10px;
      font-weight: 700;
      font-size: 0.98rem;
      cursor: pointer;
      border: none;
      transition: all 200ms ease;
      box-shadow: 0 6px 18px rgba(17,24,39,0.06);
    }
    .btn:active { transform: translateY(0); }
    .btn:disabled { opacity: 0.65; cursor: not-allowed; }
    .btn-primary {
      background: linear-gradient(135deg, #ff6a00 0%, #ff8c42 100%);
      color: #fff;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 26px rgba(255,140,66,0.18); }
    .btn-large { padding: 0.9rem 1.25rem; font-size: 1.05rem; border-radius: 12px; }
    .btn-sm { padding: 0.55rem 0.8rem; font-size: 0.9rem; border-radius: 8px; }
    .btn-outline {
      background: white;
      color: #333;
      border: 1.5px solid #e6e9ee;
    }
    .btn-danger {
      background: linear-gradient(135deg,#ef4444 0%, #f97316 100%);
      color: #fff;
    }
    /* Ensure action buttons inside program cards are evenly sized */
    .program-card .controls .btn { flex: 1 1 0; }
    .tabs-section .actions { display:flex; gap:0.75rem; align-items:center; }
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Member view modal enhancements */
    #member-view-modal .modal-content {
      max-width: 480px;
    }
    #member-view-modal .modal-header {
      color: #333;
    }
    #member-view-content {
      padding: 0 2rem 1.5rem;
    }
    #member-view-content > div {
      padding: 1rem;
      margin-bottom: 0.8rem;
      background: #fafbfc;
      border-radius: 8px;
      border-left: 3px solid #ff8c42;
      animation: slideInContent 0.3s ease;
    }
    @keyframes slideInContent {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    #member-view-content strong {
      color: #333;
      font-weight: 600;
      display: block;
      margin-bottom: 0.3rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #ff8c42;
    }
    #member-view-content span {
      color: #333;
      font-size: 0.95rem;
      word-break: break-word;
    }

    /* Program Modal enhancements */
    #modal-header::before {
      content: '\f7f3';
      font-family: 'Font Awesome 6 Free';
      font-weight: 600;
      color: #ff8c42;
      font-size: 1.3rem;
      margin-right: 0.5rem;
    }

    /* Form input enhancements for file uploads */
    .form-group input[type="file"] {
      padding: 0.8rem;
      cursor: pointer;
      color: #666;
    }
    .form-group input[type="file"]::file-selector-button {
      background: linear-gradient(135deg, #ff6a00 0%, #ff8c42 100%);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      margin-right: 0.8rem;
      transition: all 0.2s ease;
    }
    .form-group input[type="file"]::file-selector-button:hover {
      background: linear-gradient(135deg, #e85e00 0%, #ff7a2e 100%);
      transform: scale(1.02);
    }

    /* Members list animation */
    @keyframes slideInList {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>


<!-- ADMIN HEADER -->
<div class="admin-header">
  <div>
    <img src="YSP LOGO.png" alt="YSP Logo" class="logo-icon">
    <div>
      <h1>Admin Dashboard</h1>
      <p class="subtitle">Manage YSP website content and settings</p>
    </div>
  </div>
  <a href="index.html" class="back-btn">Back to Website</a>
</div>

<!-- STATS GRID removed: admin dashboard now manages stats via the Statistics tab -->

<!-- TABS SECTION -->
<div class="tabs-section">
  <div class="tabs-nav">
    <button class="tab-btn active" data-tab="statistics">Statistics</button>
    <button class="tab-btn" data-tab="programs">Programs</button>
    <button class="tab-btn" data-tab="chapters">Chapters</button>
    <button class="tab-btn" data-tab="events">Events</button>
    <button class="tab-btn" data-tab="members">Members</button>
    <button class="tab-btn" data-tab="contact">Contact</button>
  </div>

  <!-- Statistics Tab -->
  <div class="tab-content active" id="statistics">
    <div class="stats-box">
      <div class="stats-box-header">
        <h3><i class="fas fa-chart-bar"></i> Website Statistics</h3>
        <button class="edit-btn"><i class="fas fa-edit"></i> Edit</button>
      </div>
      <div class="stats-items">
        <div class="stats-item">
          <div class="label">Projects Completed</div>
          <div class="number" data-stat="projects">--</div>
        </div>
        <div class="stats-item">
          <div class="label">Active Chapters</div>
          <div class="number" data-stat="chapters">--</div>
        </div>
        <div class="stats-item">
          <div class="label">Active Members</div>
          <div class="number" data-stat="members">--</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Programs Tab -->
  <div class="tab-content" id="programs">
    <div class="stats-box">
      <h3>Programs Management</h3>
      <p style="color: #666; margin-top: 1rem;">Manage programs</p>
      <div style="margin-top:1rem; display:flex; gap:0.5rem;" class="actions">
        <button id="add-program-btn" class="btn btn-large btn-primary">+ Add Program</button>
      </div>
      <div id="admin-programs-list" style="margin-top:1.25rem; display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1rem;"></div>
    </div>
  </div>

  <!-- Chapters Tab -->
  <div class="tab-content" id="chapters">
    <div class="stats-box">
      <h3>Chapters Management</h3>
      <p style="color: #666; margin-top: 1rem;">Chapters management interface coming soon.</p>
    </div>
  </div>

  <!-- Events Tab -->
  <div class="tab-content" id="events">
    <div class="stats-box">
      <h3>Events Management</h3>
      <p style="color: #666; margin-top: 1rem;">Events management interface coming soon.</p>
    </div>
  </div>

  <!-- Members Tab -->
  <div class="tab-content" id="members">
    <div class="stats-box">
      <h3><i class="fas fa-users"></i> Members Management</h3>
      <p style="color: #666; margin-top: 1rem;">Manage organization members</p>
      
      <!-- Add Member Button -->
      <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;" class="actions">
        <button id="add-member-btn" class="btn btn-large btn-primary">
          <i class="fas fa-plus"></i> Add Member
        </button>
        
        <!-- Search Bar -->
        <input type="text" id="member-search" placeholder="Search members by name..." 
          style="flex: 1; min-width: 200px; padding: 0.6rem; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 0.95rem;">
      </div>

      <!-- Members List -->
      <div id="members-list" style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.8rem;"></div>
    </div>
  </div>

  <!-- Contact Tab -->
  <!-- Contact Tab -->
  <div class="tab-content" id="contact">
    <div class="stats-box">
      <h3>Contact Information</h3>
      <p style="color: #666; margin-top: 1rem;">Edit site contact information below</p>
      <div style="margin-top:1rem; display:grid; gap:0.75rem;">
        <label style="font-weight:600; color:#333;">Email
          <input type="email" id="admin-contact-email" placeholder="email@example.com" style="width:100%; padding:0.6rem; border-radius:6px; border:1px solid #e6e9ee; margin-top:0.4rem;">
        </label>
        <label style="font-weight:600; color:#333;">Phone
          <input type="text" id="admin-contact-phone" placeholder="+63..." style="width:100%; padding:0.6rem; border-radius:6px; border:1px solid #e6e9ee; margin-top:0.4rem;">
        </label>
        <label style="font-weight:600; color:#333;">Address
          <textarea id="admin-contact-address" placeholder="Office address..." style="width:100%; padding:0.6rem; border-radius:6px; border:1px solid #e6e9ee; margin-top:0.4rem;"></textarea>
        </label>
        <label style="font-weight:600; color:#333;">Facebook Page
          <input type="url" id="admin-contact-facebook" placeholder="https://facebook.com/..." style="width:100%; padding:0.6rem; border-radius:6px; border:1px solid #e6e9ee; margin-top:0.4rem;">
        </label>
        <div style="display:flex; gap:0.75rem; justify-content:flex-end; margin-top:0.5rem;">
          <button id="save-contact-btn" class="btn btn-primary btn-large"><i class="fas fa-save"></i> Save Contact</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Program Modal -->
<div class="modal-overlay" id="program-modal">
  <div class="modal-content">
    <div class="modal-header" id="modal-header">Add Program</div>
    <form id="program-form" style="padding: 0 2rem 2rem;">
      <div class="form-group">
        <label for="program-title">Program Title</label>
        <input type="text" id="program-title" placeholder="e.g., Education for All" required>
      </div>
      <div class="form-group">
        <label for="program-description">Description</label>
        <textarea id="program-description" placeholder="Describe the program..." required></textarea>
      </div>
      <div class="form-group">
        <label for="program-image">Program Image <span id="image-required">(required)</span></label>
        <input type="file" id="program-image" accept="image/*">
        <img id="image-preview" class="image-preview" alt="Image preview">
      </div>
      <div class="modal-actions">
        <button type="button" class="modal-btn secondary" onclick="closeModal()">Cancel</button>
        <button type="submit" class="modal-btn primary" id="save-program-btn">Save Program</button>
      </div>
    </form>
  </div>
</div>

<!-- Member Modal (Add/Edit) -->
<div class="modal-overlay" id="member-modal">
  <div class="modal-content">
    <div class="modal-header" id="member-modal-header">Add Member</div>
    <form id="member-form" style="padding: 0 2rem 2rem;">
      <div class="form-group">
        <label for="member-name">Full Name</label>
        <input type="text" id="member-name" placeholder="e.g., John Doe" required>
      </div>
      <div class="form-group">
        <label for="member-age">Age</label>
        <input type="number" id="member-age" placeholder="e.g., 25" min="1" max="120">
      </div>
      <div class="form-group">
        <label for="member-sex">Sex</label>
        <select id="member-sex">
          <option value="">Select...</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="member-email">Email</label>
        <input type="email" id="member-email" placeholder="e.g., john@example.com">
      </div>
      <div class="form-group">
        <label for="member-address">Local Address</label>
        <textarea id="member-address" placeholder="e.g., 123 Main St, City, Province"></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="modal-btn secondary" onclick="closeMemberModal()">Cancel</button>
        <button type="submit" class="modal-btn primary" id="save-member-btn">Save Member</button>
      </div>
    </form>
  </div>
</div>

<!-- Member View Modal -->
<div class="modal-overlay" id="member-view-modal">
  <div class="modal-content">
    <div class="modal-header">Member Details</div>
    <div id="member-view-content">
      <div>
        <strong>Name:</strong> <span id="view-name"></span>
      </div>
      <div>
        <strong>Age:</strong> <span id="view-age"></span>
      </div>
      <div>
        <strong>Sex:</strong> <span id="view-sex"></span>
      </div>
      <div>
        <strong>Email:</strong> <span id="view-email"></span>
      </div>
      <div>
        <strong>Local Address:</strong> <span id="view-address"></span>
      </div>
    </div>
    <div class="modal-actions">
      <button type="button" class="modal-btn secondary" onclick="closeMemberViewModal()">Close</button>
      <button type="button" class="modal-btn primary" id="edit-member-btn"><i class="fas fa-edit"></i> Edit</button>
      <button type="button" class="btn btn-danger" id="delete-member-btn"><i class="fas fa-trash"></i> Delete</button>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const tabName = this.getAttribute('data-tab');
      
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active from all buttons
      document.querySelectorAll('.tab-btn').forEach(b => {
        b.classList.remove('active');
      });
      
      // Show selected tab and mark button as active
      document.getElementById(tabName).classList.add('active');
      this.classList.add('active');
    });
  });

  // Statistics editing with Supabase sync
  (function(){
    const SUPABASE_URL = 'https://grpkcerqjfdpfttwpngf.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdycGtjZXJxamZkcGZ0dHdwbmdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzg2OTcsImV4cCI6MjA4NjkxNDY5N30.8gyM-pyCVI4RIe2kmeRcKM_4BDjg0pQkXuX4JSZQ0nQ';

    const { createClient } = window.supabase;
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const statKeys = {
      'projects': 'Projects Completed',
      'chapters': 'Active Chapters',
      'members': 'Active Members'
    };

    // Load statistics from Supabase
    async function loadStatistics(){
      try {
        console.log('ðŸ“Š Loading statistics from Supabase...');
        const { data, error } = await supabase
          .from('statistics')
          .select('stat_key, stat_value')
          .in('stat_key', Object.keys(statKeys));

        if(error) throw error;

        const statsMap = {};
        data.forEach(stat => {
          statsMap[stat.stat_key] = stat.stat_value;
        });

        // Apply to admin UI
        document.querySelectorAll('.stats-item .number').forEach(el => {
          const key = el.getAttribute('data-stat');
          if(key && statsMap[key] != null){
            el.textContent = statsMap[key];
          }
        });

        console.log('âœ… Statistics loaded:', statsMap);
      } catch (error) {
        console.error('Error loading statistics:', error);
        showToast('Error loading statistics: ' + error.message, 'error');
      }
    }

    // Update statistic in Supabase
    async function updateStatistic(key, value){
      try {
        const { error } = await supabase
          .from('statistics')
          .update({ stat_value: parseInt(value) })
          .eq('stat_key', key);

        if(error) throw error;
        console.log(`âœ… Updated ${key} to ${value}`);
      } catch (error) {
        console.error('Error updating statistic:', error);
        showToast('Error updating statistic: ' + error.message, 'error');
      }
    }

    // Edit button functionality
    const editBtn = document.querySelector('.edit-btn');
    editBtn.addEventListener('click', async function(){
      const isEditing = this.dataset.mode === 'editing';
      if(!isEditing){
        // Enter editing mode
        this.innerHTML = '<i class="fas fa-save"></i> Save';
        this.dataset.mode = 'editing';
        
        document.querySelectorAll('.stats-item .number').forEach(el => {
          const key = el.getAttribute('data-stat');
          const input = document.createElement('input');
          input.type = 'number';
          input.min = '0';
          input.value = el.textContent.trim();
          input.className = 'stats-input';
          input.style.width = '100%';
          input.style.fontSize = '1.6rem';
          input.style.fontWeight = '800';
          input.setAttribute('data-stat', key);
          el.replaceWith(input);
        });
      } else {
        // Save mode
        editBtn.disabled = true;
        editBtn.innerHTML = '<span class="loading-spinner"></span>';

        try {
          const inputs = document.querySelectorAll('.stats-input');
          const updatePromises = [];

          inputs.forEach(inp => {
            const key = inp.getAttribute('data-stat');
            const value = inp.value;
            updatePromises.push(updateStatistic(key, value));
            
            // Create display element
            const div = document.createElement('div');
            div.className = 'number';
            div.setAttribute('data-stat', key);
            div.textContent = value;
            inp.replaceWith(div);
          });

          // Wait for all updates to complete
          await Promise.all(updatePromises);
          
          showToast('Statistics updated successfully', 'success');
          this.innerHTML = '<i class="fas fa-edit"></i> Edit';
          this.dataset.mode = '';
        } catch (error) {
          console.error('Error saving statistics:', error);
          showToast('Error saving statistics', 'error');
        } finally {
          editBtn.disabled = false;
        }
      }
    });

    // Real-time subscription
    const subscription = supabase
      .channel('statistics_changes')
      .on(
        'postgres_changes',
        { event: 'UPDATE', schema: 'public', table: 'statistics' },
        (payload) => {
          console.log('ðŸ”„ Statistics updated:', payload.new);
          loadStatistics();
        }
      )
      .subscribe((status) => {
        console.log('ðŸ“¡ Statistics real-time subscription:', status);
      });

    // Initial load
    loadStatistics();

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      supabase.removeChannel(subscription);
    });
  })();

  // Programs admin editor with Supabase integration
  (function(){
    const SUPABASE_URL = 'https://grpkcerqjfdpfttwpngf.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdycGtjZXJxamZkcGZ0dHdwbmdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzg2OTcsImV4cCI6MjA4NjkxNDY5N30.8gyM-pyCVI4RIe2kmeRcKM_4BDjg0pQkXuX4JSZQ0nQ';

    const { createClient } = window.supabase;
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    let currentEditingId = null;
    let programsCache = [];

    // Verify Supabase connection
    console.log('ðŸ”— Supabase initialized:', { url: SUPABASE_URL });

    // Modal functions
    window.closeModal = function(){
      document.getElementById('program-modal').classList.remove('active');
      document.getElementById('program-form').reset();
      document.getElementById('image-preview').classList.remove('active');
      currentEditingId = null;
    };

    function openModal(isEdit, program = null){
      const modal = document.getElementById('program-modal');
      const header = document.getElementById('modal-header');
      const form = document.getElementById('program-form');
      const imageInput = document.getElementById('program-image');
      const imageRequired = document.getElementById('image-required');
      
      if(isEdit && program){
        header.textContent = 'Edit Program';
        document.getElementById('program-title').value = program.title;
        document.getElementById('program-description').value = program.description;
        currentEditingId = program.id;
        imageInput.removeAttribute('required');
        imageRequired.textContent = '(optional - leave blank to keep current image)';
        
        // Show image preview if exists
        if(program.image_data){
          const preview = document.getElementById('image-preview');
          preview.src = program.image_data;
          preview.classList.add('active');
        }
      } else {
        header.textContent = 'Add Program';
        form.reset();
        document.getElementById('image-preview').classList.remove('active');
        currentEditingId = null;
        imageInput.setAttribute('required', 'required');
        imageRequired.textContent = '(required)';
      }
      
      modal.classList.add('active');
    }

    window.editProgram = function(id){
      const program = programsCache.find(p => p.id === id);
      if(program) openModal(true, program);
    };

    // Image preview
    document.getElementById('program-image').addEventListener('change', function(){
      const file = this.files[0];
      if(!file) return;
      
      // Compress image before preview
      compressImage(file, (compressedBase64) => {
        const preview = document.getElementById('image-preview');
        preview.src = compressedBase64;
        preview.classList.add('active');
        showToast('Image compressed and ready', 'success');
      });
    });

    // Image compression function
    function compressImage(file, callback){
      const reader = new FileReader();
      reader.onload = function(event){
        const img = new Image();
        img.onload = function(){
          const canvas = document.createElement('canvas');
          const MAX_WIDTH = 800;
          const MAX_HEIGHT = 600;
          let width = img.width;
          let height = img.height;

          // Calculate new dimensions
          if(width > height){
            if(width > MAX_WIDTH){
              height = Math.round((height * MAX_WIDTH) / width);
              width = MAX_WIDTH;
            }
          } else {
            if(height > MAX_HEIGHT){
              width = Math.round((width * MAX_HEIGHT) / height);
              height = MAX_HEIGHT;
            }
          }

          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);

          // Compress to JPEG with lower quality
          const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);
          console.log(`ðŸ“¸ Image compressed: ${(file.size / 1024).toFixed(2)}KB â†’ ${(compressedBase64.length / 1024).toFixed(2)}KB`);
          callback(compressedBase64);
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Form submission
    document.getElementById('program-form').addEventListener('submit', async function(e){
      e.preventDefault();
      
      const title = document.getElementById('program-title').value;
      const desc = document.getElementById('program-description').value;
      const imageInput = document.getElementById('program-image');
      const saveBtn = document.getElementById('save-program-btn');
      
      // Validate that image is provided for new programs
      if(!currentEditingId && !imageInput.files[0]){
        showToast('Please select an image for the program', 'error');
        return;
      }
      
      saveBtn.disabled = true;
      saveBtn.innerHTML = '<span class="loading-spinner"></span>';

      try {
        let imageData = null;
        
        // If a new image is selected, compress it
        if(imageInput.files[0]){
          const file = imageInput.files[0];
          
          imageData = await new Promise((resolve) => {
            compressImage(file, (compressedBase64) => {
              resolve(compressedBase64);
            });
          });
        } else if(currentEditingId){
          // If editing and no new image, keep the old one
          const existing = programsCache.find(p => p.id === currentEditingId);
          imageData = existing ? existing.image_data : null;
        }

        if(currentEditingId){
          // Update existing program
          console.log('ðŸ“ Updating program:', currentEditingId);
          const { error } = await supabase
            .from('programs')
            .update({
              title: title,
              description: desc,
              image_data: imageData,
              updated_at: new Date()
            })
            .eq('id', currentEditingId);

          if(error) throw error;
          console.log('âœ… Program updated successfully');
          showToast('Program updated successfully', 'success');
        } else {
          // Insert new program
          console.log('âž• Adding new program');
          const { error } = await supabase
            .from('programs')
            .insert([{
              title: title,
              description: desc,
              image_data: imageData
            }]);

          if(error) throw error;
          console.log('âœ… Program added successfully');
          showToast('Program added successfully', 'success');
        }

        window.closeModal();
        await loadPrograms();
      } catch (error) {
        console.error('Error saving program:', error);
        showToast('Error saving program: ' + error.message, 'error');
      } finally {
        saveBtn.disabled = false;
        saveBtn.innerHTML = 'Save Program';
      }
    });

    // Load programs from Supabase
    async function loadPrograms(){
      try {
        console.log('ðŸ“¦ Loading programs from Supabase...');
        const { data, error } = await supabase
          .from('programs')
          .select('*')
          .order('created_at', { ascending: true });

        if(error){
          console.error('âŒ Supabase error:', error);
          throw error;
        }
        
        programsCache = data || [];
        console.log('âœ… Programs loaded:', programsCache.length, 'programs');
        renderPrograms();
      } catch (error) {
        console.error('Error loading programs:', error);
        showToast('Error loading programs: ' + error.message, 'error');
      }
    }

    // Render programs
    function renderPrograms(){
      const container = document.getElementById('admin-programs-list');
      if(!container) return;
      
      container.innerHTML = '';
      
      programsCache.forEach(program => {
        const card = document.createElement('div');
        card.className = 'program-card';
        
        const img = document.createElement('img');
        img.className = 'program-img';
        img.src = program.image_data || '';
        img.alt = program.title;
        
        const body = document.createElement('div');
        body.className = 'program-body';
        
        const title = document.createElement('div');
        title.style.fontWeight = '600';
        title.style.fontSize = '0.95rem';
        title.textContent = program.title;
        
        const desc = document.createElement('div');
        desc.style.fontSize = '0.85rem';
        desc.style.color = '#666';
        desc.style.lineHeight = '1.4';
        desc.textContent = program.description.substring(0, 100) + (program.description.length > 100 ? '...' : '');
        
        const controls = document.createElement('div');
        controls.className = 'controls';
        controls.style.gap = '0.5rem';
        
        const editBtn = document.createElement('button');
        editBtn.className = 'btn btn-sm btn-primary';
        editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
        editBtn.onclick = () => window.editProgram(program.id);

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn btn-sm btn-outline';
        deleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete';
        deleteBtn.onclick = () => deleteProgram(program.id);
        
        controls.appendChild(editBtn);
        controls.appendChild(deleteBtn);
        
        body.appendChild(title);
        body.appendChild(desc);
        body.appendChild(controls);
        
        card.appendChild(img);
        card.appendChild(body);
        
        container.appendChild(card);
      });
    }

    // Delete program
    async function deleteProgram(id){
      if(!confirm('Are you sure you want to delete this program?')) return;
      
      try {
        const { error } = await supabase
          .from('programs')
          .delete()
          .eq('id', id);

        if(error) throw error;
        
        showToast('Program deleted successfully', 'warn');
        await loadPrograms();
      } catch (error) {
        console.error('Error deleting program:', error);
        showToast('Error deleting program: ' + error.message, 'error');
      }
    }

    window.deleteProgram = deleteProgram;

    // Add program button
    const addBtn = document.getElementById('add-program-btn');
    if(addBtn){
      addBtn.addEventListener('click', function(){
        openModal(false);
      });
    }

    // Real-time subscription
    const subscription = supabase
      .channel('programs_changes')
      .on(
        'postgres_changes',
        { event: '*', schema: 'public', table: 'programs' },
        (payload) => {
          console.log('ðŸ”„ Real-time update received:', payload);
          loadPrograms();
        }
      )
      .subscribe((status) => {
        console.log('ðŸ“¡ Real-time subscription status:', status);
      });

    // Initial load
    loadPrograms();

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      supabase.removeChannel(subscription);
    });
  })();


  // Toast helper
  function showToast(message, type = 'success', duration = 3000){
    let container = document.querySelector('.toast-container');
    if(!container){ container = document.createElement('div'); container.className = 'toast-container'; document.body.appendChild(container); }
    const t = document.createElement('div'); t.className = 'toast ' + (type || 'success'); t.textContent = message;
    container.appendChild(t);
    // trigger animation
    requestAnimationFrame(()=> t.classList.add('show'));
    setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=> t.remove(),260); }, duration);
  }

  // Members management with Supabase
  (function(){
    const SUPABASE_URL = 'https://grpkcerqjfdpfttwpngf.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdycGtjZXJxamZkcGZ0dHdwbmdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzg2OTcsImV4cCI6MjA4NjkxNDY5N30.8gyM-pyCVI4RIe2kmeRcKM_4BDjg0pQkXuX4JSZQ0nQ';

    const { createClient } = window.supabase;
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    let membersCache = [];
    let currentEditingMemberId = null;
    let currentViewingMemberId = null;

    console.log('ðŸ‘¥ Members management initialized');

    // Modal control functions
    window.closeMemberModal = function(){
      document.getElementById('member-modal').classList.remove('active');
      document.getElementById('member-form').reset();
      currentEditingMemberId = null;
    };

    window.closeMemberViewModal = function(){
      document.getElementById('member-view-modal').classList.remove('active');
      currentViewingMemberId = null;
    };

    function openMemberModal(isEdit, member = null){
      const modal = document.getElementById('member-modal');
      const header = document.getElementById('member-modal-header');
      const form = document.getElementById('member-form');

      if(isEdit && member){
        header.textContent = 'Edit Member';
        document.getElementById('member-name').value = member.name || '';
        document.getElementById('member-age').value = member.age || '';
        document.getElementById('member-sex').value = member.sex || '';
        document.getElementById('member-email').value = member.email || '';
        document.getElementById('member-address').value = member.local_address || '';
        currentEditingMemberId = member.id;
        document.getElementById('save-member-btn').textContent = 'Update Member';
      } else {
        header.textContent = 'Add Member';
        form.reset();
        currentEditingMemberId = null;
        document.getElementById('save-member-btn').textContent = 'Add Member';
      }

      modal.classList.add('active');
    }

    function openMemberViewModal(member){
      currentViewingMemberId = member.id;
      document.getElementById('view-name').textContent = member.name || '--';
      document.getElementById('view-age').textContent = member.age ? member.age + ' years' : '--';
      document.getElementById('view-sex').textContent = member.sex || '--';
      document.getElementById('view-email').textContent = member.email || '--';
      document.getElementById('view-address').textContent = member.local_address || '--';

      document.getElementById('member-view-modal').classList.add('active');
    }

    // Load members from Supabase
    async function loadMembers(searchQuery = ''){
      try {
        console.log('ðŸ‘¥ Loading members from Supabase...');
        let query = supabase
          .from('members')
          .select('*')
          .order('created_at', { ascending: false });

        const { data, error } = await query;

        if(error) throw error;

        membersCache = data || [];

        // Filter by search query
        let filteredMembers = membersCache;
        if(searchQuery){
          filteredMembers = membersCache.filter(m => 
            m.name.toLowerCase().includes(searchQuery.toLowerCase())
          );
        }

        console.log('âœ… Loaded', membersCache.length, 'members');
        renderMembersList(filteredMembers);
      } catch (error) {
        console.error('Error loading members:', error);
        showToast('Error loading members: ' + error.message, 'error');
      }
    }

    // Render members list
    function renderMembersList(members){
      const container = document.getElementById('members-list');
      if(!container) return;

      container.innerHTML = '';

      if(members.length === 0){
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 2rem; background: #fafbfc; border-radius: 8px; border: 1px dashed #dfe4ea;">No members found</div>';
        return;
      }

      members.forEach((member, index) => {
        const item = document.createElement('div');
        item.style.cssText = `
          display: flex;
          align-items: center;
          gap: 1.2rem;
          background: white;
          padding: 1.2rem 1.5rem;
          border-radius: 8px;
          border: 1.5px solid #e8ebf0;
          cursor: pointer;
          transition: all 0.25s ease;
          box-shadow: 0 2px 4px rgba(0,0,0,0.03);
          animation: slideInList 0.3s ease ${index * 0.05}s both;
        `;
        
        item.onmouseover = () => {
          item.style.borderColor = '#ff8c42';
          item.style.boxShadow = '0 6px 16px rgba(255,140,66,0.12)';
          item.style.transform = 'translateX(4px)';
        };
        
        item.onmouseout = () => {
          item.style.borderColor = '#e8ebf0';
          item.style.boxShadow = '0 2px 4px rgba(0,0,0,0.03)';
          item.style.transform = 'translateX(0)';
        };

        // Member avatar
        const avatar = document.createElement('div');
        avatar.style.cssText = `
          min-width: 48px;
          width: 48px;
          height: 48px;
          border-radius: 50%;
          background: linear-gradient(135deg, #ff6a00, #ff8c42);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: 700;
          font-size: 1.2rem;
          box-shadow: 0 2px 8px rgba(255,140,66,0.2);
        `;
        avatar.textContent = (member.name || 'M').charAt(0).toUpperCase();

        // Member info
        const info = document.createElement('div');
        info.style.cssText = 'flex: 1; min-width: 0;';
        info.innerHTML = `
          <div style="font-weight: 600; color: #333; font-size: 0.95rem; margin-bottom: 0.3rem;">${member.name}</div>
          <div style="color: #999; font-size: 0.85rem; display: flex; gap: 1.5rem; flex-wrap: wrap;">
            ${member.age ? `<span><i class="fas fa-birthday-cake" style="color: #ff8c42; margin-right: 0.3rem;"></i>${member.age} years</span>` : ''}
            ${member.sex ? `<span><i class="fas fa-${member.sex === 'Male' ? 'mars' : member.sex === 'Female' ? 'venus' : 'user'}" style="color: #ff8c42; margin-right: 0.3rem;"></i>${member.sex}</span>` : ''}
            ${member.email ? `<span title="${member.email}"><i class="fas fa-envelope" style="color: #ff8c42; margin-right: 0.3rem;"></i><a href="mailto:${member.email}" style="color: #ff8c42; text-decoration: none;" onclick="event.stopPropagation();">${member.email.split('@')[0]}</a></span>` : ''}
          </div>
        `;

        // Action indicator
        const indicator = document.createElement('div');
        indicator.style.cssText = `
          color: #ff8c42;
          font-size: 1.2rem;
          opacity: 0.5;
          transition: all 0.2s ease;
        `;
        indicator.innerHTML = '<i class="fas fa-chevron-right"></i>';

        item.addEventListener('mouseenter', () => {
          indicator.style.opacity = '1';
          indicator.style.transform = 'translateX(4px)';
        });

        item.addEventListener('mouseleave', () => {
          indicator.style.opacity = '0.5';
          indicator.style.transform = 'translateX(0)';
        });

        item.appendChild(avatar);
        item.appendChild(info);
        item.appendChild(indicator);

        item.onclick = () => openMemberViewModal(member);
        container.appendChild(item);
      });
    }

    // Form submission
    document.getElementById('member-form').addEventListener('submit', async function(e){
      e.preventDefault();

      const name = document.getElementById('member-name').value;
      const age = document.getElementById('member-age').value ? parseInt(document.getElementById('member-age').value) : null;
      const sex = document.getElementById('member-sex').value;
      const email = document.getElementById('member-email').value;
      const address = document.getElementById('member-address').value;

      if(!name.trim()){
        showToast('Please enter member name', 'error');
        return;
      }

      const saveBtn = document.getElementById('save-member-btn');
      saveBtn.disabled = true;
      saveBtn.innerHTML = '<span class="loading-spinner"></span>';

      try {
        if(currentEditingMemberId){
          // Update member
          console.log('ðŸ“ Updating member:', currentEditingMemberId);
          const { error } = await supabase
            .from('members')
            .update({
              name,
              age,
              sex,
              email,
              local_address: address
            })
            .eq('id', currentEditingMemberId);

          if(error) throw error;
          console.log('âœ… Member updated');
          showToast('Member updated successfully', 'success');
        } else {
          // Add member
          console.log('âž• Adding new member');
          const { error } = await supabase
            .from('members')
            .insert([{
              name,
              age,
              sex,
              email,
              local_address: address
            }]);

          if(error) throw error;
          console.log('âœ… Member added');
          showToast('Member added successfully', 'success');
        }

        window.closeMemberModal();
        await loadMembers();
      } catch (error) {
        console.error('Error saving member:', error);
        showToast('Error saving member: ' + error.message, 'error');
      } finally {
        saveBtn.disabled = false;
        saveBtn.innerHTML = currentEditingMemberId ? 'Update Member' : 'Add Member';
      }
    });

    // Edit member
    document.getElementById('edit-member-btn').addEventListener('click', function(){
      const member = membersCache.find(m => m.id === currentViewingMemberId);
      if(member){
        window.closeMemberViewModal();
        openMemberModal(true, member);
      }
    });

    // Delete member
    document.getElementById('delete-member-btn').addEventListener('click', async function(){
      if(!confirm('Are you sure you want to delete this member?')) return;

      try {
        const { error } = await supabase
          .from('members')
          .delete()
          .eq('id', currentViewingMemberId);

        if(error) throw error;

        console.log('ðŸ—‘ï¸ Member deleted');
        showToast('Member deleted successfully', 'warn');
        window.closeMemberViewModal();
        await loadMembers();
      } catch (error) {
        console.error('Error deleting member:', error);
        showToast('Error deleting member: ' + error.message, 'error');
      }
    });

    // Add member button
    const addMemberBtn = document.getElementById('add-member-btn');
    if(addMemberBtn){
      addMemberBtn.addEventListener('click', () => openMemberModal(false));
    }

    // Search functionality
    const searchInput = document.getElementById('member-search');
    if(searchInput){
      searchInput.addEventListener('input', function(){
        const query = this.value;
        const filtered = membersCache.filter(m => 
          m.name.toLowerCase().includes(query.toLowerCase())
        );
        renderMembersList(filtered);
      });
    }

    // Real-time subscription
    const subscription = supabase
      .channel('members_changes')
      .on(
        'postgres_changes',
        { event: '*', schema: 'public', table: 'members' },
        (payload) => {
          console.log('ðŸ”„ Members updated:', payload.eventType);
          loadMembers();
        }
      )
      .subscribe((status) => {
        console.log('ðŸ“¡ Members real-time subscription:', status);
      });

    // Initial load
    loadMembers();

    // Cleanup
    window.addEventListener('beforeunload', () => {
      supabase.removeChannel(subscription);
    });
  })();

    // Contact management (admin) â€” Supabase-backed, realtime
    (function(){
      const SUPABASE_URL = 'https://grpkcerqjfdpfttwpngf.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdycGtjZXJxamZkcGZ0dHdwbmdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzg2OTcsImV4cCI6MjA4NjkxNDY5N30.8gyM-pyCVI4RIe2kmeRcKM_4BDjg0pQkXuX4JSZQ0nQ';

      const { createClient } = window.supabase;
      const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

      async function loadContact(){
        try {
          const { data, error } = await supabase.from('contact').select('*').eq('id', 1).maybeSingle();
          if(error) throw error;
          const c = data || { email: 'phyouthservice@gmail.com', phone: '+639177798413', address: '123 Volunteer Street, Manila, Philippines 1000', facebook: 'https://www.facebook.com/YOUTHSERVICEPHILIPPINES' };
          const e = document.getElementById('admin-contact-email');
          const p = document.getElementById('admin-contact-phone');
          const a = document.getElementById('admin-contact-address');
          const f = document.getElementById('admin-contact-facebook');
          if(e) e.value = c.email || '';
          if(p) p.value = c.phone || '';
          if(a) a.value = c.address || '';
          if(f) f.value = c.facebook || '';
        } catch (err){
          console.error('Error loading contact:', err);
          showToast('Error loading contact info: ' + (err.message || err), 'error');
        }
      }

      async function saveContact(){
        const btn = document.getElementById('save-contact-btn');
        if(!btn) return;
        btn.disabled = true;
        const orig = btn.innerHTML;
        btn.innerHTML = '<span class="loading-spinner"></span>';

        try {
          const email = document.getElementById('admin-contact-email').value.trim();
          const phone = document.getElementById('admin-contact-phone').value.trim();
          const address = document.getElementById('admin-contact-address').value.trim();
          const facebook = document.getElementById('admin-contact-facebook').value.trim();

          const { error } = await supabase.from('contact').upsert({ id: 1, email, phone, address, facebook });
          if(error) throw error;
          showToast('Contact information saved', 'success');
        } catch (err){
          console.error('Error saving contact:', err);
          showToast('Error saving contact: ' + (err.message || err), 'error');
        } finally {
          btn.disabled = false;
          btn.innerHTML = orig;
        }
      }

      document.addEventListener('DOMContentLoaded', function(){
        const saveBtn = document.getElementById('save-contact-btn');
        if(saveBtn) saveBtn.addEventListener('click', saveContact);
        loadContact();
      });

      const subscription = supabase
        .channel('contact_changes')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'contact' }, (payload) => {
          console.log('Contact changed:', payload);
          loadContact();
        })
        .subscribe((status) => console.log('Contact realtime status:', status));

      window.addEventListener('beforeunload', () => { supabase.removeChannel(subscription); });
    })();
</script>

</body>
</html>
